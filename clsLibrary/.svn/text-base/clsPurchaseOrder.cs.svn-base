using System;
using System.Collections.Generic;
using System.Text;
using System.Data;
using System.Data.SqlClient;
using DbConnection;

namespace clsLibrary
{
    public class clsPurchaseOrder
    {
        #region General Declaration
        private int intErrCode;
        private int intTempDocNo;
        private int intPackSize;
        private int intCreditPeriod;

        private string strLocaCode;
        private string strLocaName;
        private string strSuppCode;
        private string strSuppName;
        private string strProductCode;
        private string strProductName;
        private string strSqlStatement;
        private string strTempDocumentNo;
        private string strDataSetName;
        private string strPostDate;
        private string strExpectedDate;
        private string strRemark;
        private string strOrgDocNo;
        private string strSavedDocNo;
        private string strRecallSaveDocNo;
        private string strPay_Type;
        private string strUnit;
        private string strContactPerson;
        private string strShiftToHeader;
        private string strShiftAddress1;
        private string strShiftAddress2;

        private float fltQty;
        private float fltCurrentQty;
        private float fltTotalQty;

        private decimal decPurchasePrice;
        private decimal decSellingPrice;
        private decimal decGrossAmount;
        private decimal decAmount;
        private decimal decTotalAmount;
        private decimal decTax;

        private DataSet dsItemDataSet;
        private DataSet dsSupplierDataSet;
        private DataSet dsTempPon;
        private DataSet dsForReport;

        private Boolean blRecordFound;

        private SqlDataReader DataReader;
        #endregion

        #region Properties
        public string TempDocNo
        {
            get
            {
                return strTempDocumentNo;
            }
            set
            {
                strTempDocumentNo = value;
            }
        }

        public string SavedDocNo
        {
            get
            {
                return strSavedDocNo;
            }
            set
            {
                strSavedDocNo = value;
            }
        }

        public string RecallSaveDocNo
        {
            get
            {
                return strRecallSaveDocNo;
            }
            set
            {
                strRecallSaveDocNo = value;
            }
        }

        public string OrgDocNo
        {
            get
            {
                return strOrgDocNo;
            }
            set
            {
                strOrgDocNo = value;
            }
        }

        public string ExpectedDate
        {
            get
            {
                return strExpectedDate;
            }
            set
            {
                strExpectedDate = value;
            }
        }

        public string ContactPerson
        {
            get
            {
                return strContactPerson;
            }
            set
            {
                strContactPerson = value;
            }
        }

        public string  ShiftToHeader
        {
            get
            {
                return strShiftToHeader;
            }
            set
            {
                strShiftToHeader = value;
            }
        }

        public string ShiftAddress1
        {
            get
            {
                return strShiftAddress1;
            }
            set
            {
                strShiftAddress1 = value;
            }
        }

        public string ShiftAddress2
        {
            get
            {
                return strShiftAddress2;
            }
            set
            {
                strShiftAddress2 = value;
            }
        }

        public int ErrorCode
        {
            get
            {
                return intErrCode;
            }
            set
            {
                intErrCode = value;
            }
        }

        public int PackSize
        {
            get
            {
                return intPackSize;
            }
            set
            {
                intPackSize = value;
            }
        }

        public string LocaCode
        {
            get
            {
                return strLocaCode;
            }
            set
            {
                strLocaCode = value;
            }
        }

        public string LocaName
        {
            get
            {
                return strLocaName;
            }
            set
            {
                strLocaName = value;
            }
        }

        public string SuppCode
        {
            get
            {
                return strSuppCode;
            }
            set
            {
                strSuppCode = value;
            }
        }

        public string SuppName
        {
            get
            {
                return strSuppName ;
            }
            set
            {
                strSuppName  = value;
            }
        }

        public string ProductCode
        {
            get
            {
                return strProductCode;
            }
            set
            {
                strProductCode = value;
            }
        }

        public string ProductName
        {
            get
            {
                return strProductName;
            }
            set
            {
                strProductName = value;
            }
        }

        public string Unit
        {
            get
            {
                return strUnit;
            }
            set
            {
                strUnit = value;
            }
        }

        public string Remark
        {
            get
            {
                return strRemark;
            }
            set
            {
                strRemark = value;
            }
        }

        public string Pay_Type
        {
            get
            {
                return strPay_Type;
            }
            set
            {
                strPay_Type = value;
            }
        }

        public float Qty
        {
            get
            {
                return fltQty;
            }
            set
            {
                fltQty = value;
            }
        }

        public float CurrentQty
        {
            get
            {
                return fltCurrentQty;
            }
            set
            {
                fltCurrentQty = value;
            }
        }

        public float TotalQty
        {
            get
            {
                return fltTotalQty;
            }
            set
            {
                fltTotalQty = value;
            }
        }

        public decimal TotalAmount
        {
            get
            {
                return decTotalAmount;
            }
            set
            {
                decTotalAmount = value;
            }
        }

        public decimal PurchasePrice
        {
            get
            {
                return decPurchasePrice;
            }
            set
            {
                decPurchasePrice = value;
            }
        }

        public decimal SellingPrice
        {
            get
            {
                return decSellingPrice;
            }
            set
            {
                decSellingPrice = value;
            }
        }

        public decimal Amount
        {
            get
            {
                return decAmount;
            }
            set
            {
                decAmount = value;
            }
        }

        public decimal GrossAmount
        {
            get
            {
                return decGrossAmount;
            }
            set
            {
                decGrossAmount = value;
            }
        }

        public decimal Tax
        {
            get
            {
                return decTax;
            }
            set
            {
                decTax = value;
            }
        }

        public int CreditPeriod
        {
            get
            {
                return intCreditPeriod;
            }
            set
            {
                intCreditPeriod = value;
            }
        }

        public string SqlStatement
        {
            get
            {
                return strSqlStatement;
            }
            set
            {
                strSqlStatement = value;
            }
        }

        public string DataetName
        {
            get
            {
                return strDataSetName;
            }
            set
            {
                strDataSetName = value;
            }
        }

        public DataSet GetItemDataset
        {
            get
            {
                return dsItemDataSet;
            }
            set
            {
                dsItemDataSet = value;
            }
        }

        public DataSet GetSupplierDataset
        {
            get
            {
                return dsSupplierDataSet ;
            }
            set
            {
                dsSupplierDataSet = value;
            }
        }

        public DataSet GetReportDataset
        {
            get
            {
                return dsForReport ;
            }
            set
            {
                dsForReport = value;
            }
        }

        public DataSet TempPon
        {
            get
            {
                return dsTempPon;
            }
            set
            {
                dsTempPon = value;
            }
        }

        public Boolean RecordFound
        {
            get
            {
                return blRecordFound;
            }
            set
            {
                blRecordFound = value;
            }
        }

        #endregion

        public void GetTempDocumentNo()
        {
            DataReader = dbcon.GetReader(strSqlStatement + LoginManager.LocaCode);
            if (DataReader.Read())
            {
                intTempDocNo = (int)DataReader.GetSqlInt32(0);
                //String.Format("{0:00000}", 15); 
                strTempDocumentNo = string.Format("{0:000000}", intTempDocNo);
                if (LoginManager.UserName.Trim().Length > 2)
                {
                    strTempDocumentNo = LoginManager.UserName.Trim().Substring(0, 2).ToUpper() + LoginManager.LocaCode.Trim().Substring(0, 2) + strTempDocumentNo; ;
                }
                else
                {
                    strTempDocumentNo = LoginManager.UserName.Trim().ToUpper() + "0" + LoginManager.LocaCode.Trim().Substring(0, 2) + strTempDocumentNo; ;
                }
            }
            dbcon.CloseReader();
            DataReader.Dispose();

            //UpDate Record No
            intErrCode = 0;
            dbcon.connection.Open();
            SqlCommand command = new SqlCommand();
            command.Connection = dbcon.connection;
            command.CommandType = CommandType.StoredProcedure;
            command.CommandText = "sp_UpdateTempDocNo";
            command.Parameters.Clear();
            command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
            command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));
            command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.VarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));

            command.ExecuteNonQuery();
            command.UpdatedRowSource = UpdateRowSource.OutputParameters;
            ErrorCode = (int)(command.Parameters["@Err_x"].Value);
            dbcon.connection.Close();

            GetTempDataset();
        }

        public void GetTempDataset()
        {
            //get Temporary DataSet For Purchase Order Note
            dsTempPon = dbcon.getDataset("select Prod_Code, Prod_Name, Unit, Purchase_Price, Selling_Price, Qty, FreeQty, Discount,Amount FROM TransactionTemp_Details WHERE Doc_No = '" + strTempDocumentNo + "' AND IId = 'PON' AND Loca = " + LoginManager.LocaCode + " Order by Ln", "PurchaseOrder");
        }

        public void GetItemDetails()
        {
            dsItemDataSet = dbcon.getDataset(strSqlStatement, strDataSetName);
        }

        public void GetSupplierDetails()
        {
            dsSupplierDataSet = dbcon.getDataset(strSqlStatement, strDataSetName);
        }

        public void ReadProductDetails()
        {
            DataReader = dbcon.GetReader(strSqlStatement + LoginManager.LocaCode);
            blRecordFound = false;
            if (DataReader.Read())
            {
                strProductCode = DataReader["Prod_Code"].ToString();
                strProductName = DataReader["Prod_Name"].ToString();
                fltCurrentQty = (float)DataReader.GetSqlDouble(4);
                intPackSize = (int)DataReader.GetSqlInt16(5);
                decPurchasePrice = (decimal)DataReader["Purchase_price"];
                decSellingPrice = (decimal)DataReader["Selling_Price"];
                strUnit = DataReader["Unit"].ToString();
                blRecordFound = true;
            }
            else
            {
                strProductCode = string.Empty;
                strProductName = string.Empty;
                fltCurrentQty = 0;
                decPurchasePrice = 0;
                decSellingPrice = 0;
                strUnit = string.Empty;
                blRecordFound = false;
            }
            dbcon.CloseReader();
            DataReader.Dispose();
        }

        public void ReadSupplierDetails()
        {
            DataReader = dbcon.GetReader(strSqlStatement);
            blRecordFound = false;
            if (DataReader.Read())
            {
                strSuppCode = DataReader["Supp_Code"].ToString();
                strSuppName = DataReader["Supp_Name"].ToString();
                blRecordFound = true;
            }
            else
            {
                strSuppCode = string.Empty;
                strSuppName = string.Empty;
                blRecordFound = false;
            }
            dbcon.CloseReader();
            DataReader.Dispose();
        }

        public void ReadTempTransDetails()
        {
            DataReader = dbcon.GetReader(strSqlStatement);
            blRecordFound = false;
            if (DataReader.Read())
            {
                blRecordFound = true;
            }
            else
            {
                blRecordFound = false;
            }
            dbcon.CloseReader();
            DataReader.Dispose();
        }

        public void ReadExsistProductDetails()
        {
            DataReader = dbcon.GetReader(strSqlStatement + LoginManager.LocaCode);
            if (DataReader.Read())
            {
                fltQty = (float)DataReader.GetSqlDouble(0);
            }
            else
            {
                fltQty = 0;
            }
            dbcon.CloseReader();
            DataReader.Dispose();
        }

        public void UpdatePonTempDataSet()
        {
            intErrCode = 0;
            dbcon.connection.Open();
            SqlCommand command = new SqlCommand();
            command.Connection = dbcon.connection;
            command.CommandType = CommandType.StoredProcedure;
            command.CommandText = "sp_PoTemp_Update";
            command.Parameters.Clear();
            command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
            command.Parameters.Add(new SqlParameter("@Doc_No", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strTempDocumentNo));
            command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.VarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));
            command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));
            command.Parameters.Add(new SqlParameter("@Prod_Code", SqlDbType.NVarChar, 25, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strProductCode));
            command.Parameters.Add(new SqlParameter("@Prod_Name", SqlDbType.NVarChar, 100, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strProductName));
            command.Parameters.Add(new SqlParameter("@Qty", SqlDbType.Float, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, fltQty));
            command.Parameters.Add(new SqlParameter("@Purchase_price", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decPurchasePrice));
            command.Parameters.Add(new SqlParameter("@Selling_Price", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decSellingPrice));
            command.Parameters.Add(new SqlParameter("@Unit", SqlDbType.VarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strUnit));
            command.Parameters.Add(new SqlParameter("@Pack_Size", SqlDbType.Int, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, intPackSize));
            command.Parameters.Add(new SqlParameter("@Amount", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decAmount));

            command.ExecuteNonQuery();
            command.UpdatedRowSource = UpdateRowSource.OutputParameters;
            ErrorCode = (int)(command.Parameters["@Err_x"].Value);
            dbcon.connection.Close();
        }

        public void GetTotalValues()
        {
            SqlCommand command = new SqlCommand();
            command = dbcon.connection.CreateCommand();
            command.CommandText = "select isnull(sum(Amount),0) from TransactionTemp_Details WHERE Iid = 'PON' AND Loca = '" + LoginManager.LocaCode + "' AND Doc_No = '" + strTempDocumentNo + "'";
            dbcon.OpenConnection();
            decTotalAmount = decimal.Parse(command.ExecuteScalar().ToString());
            command.CommandText = "select isnull(sum(Qty),0) from TransactionTemp_Details WHERE Iid = 'PON' AND Loca = '" + LoginManager.LocaCode + "' AND Doc_No = '" + strTempDocumentNo + "'";
            fltTotalQty = float.Parse(command.ExecuteScalar().ToString());
            dbcon.CloseConnection();
        }

        public void GetOrgDocumentNo()
        {
            DataReader = dbcon.GetReader("select Po from DocumentNoDetails WHERE Loca = " + LoginManager.LocaCode);
            if (DataReader.Read())
            {
                intTempDocNo = (int)DataReader.GetSqlInt32(0);
                //String.Format("{0:00000}", 15); 
                strOrgDocNo = string.Format("{0:000000}", intTempDocNo);
                if (LoginManager.UserName.Trim().Length > 2)
                {
                    strOrgDocNo = LoginManager.UserName.Trim().Substring(0, 2).ToUpper() + LoginManager.LocaCode.Trim().Substring(0, 2) + strOrgDocNo; ;
                }
                else
                {
                    strOrgDocNo = LoginManager.UserName.Trim().ToUpper() + "0" + LoginManager.LocaCode.Trim().Substring(0, 2) + strOrgDocNo; ;
                }
            }
            dbcon.CloseReader();
            DataReader.Dispose();
        }

        public void PurchaseOrderNoteApply()
        {
            DateTime PostDate = DateTime.Now;

            intErrCode = 0;
            //Get Orginal Document No
            GetOrgDocumentNo();
            strPostDate = string.Format("{0:dd/MM/yyyy}", PostDate);

            dbcon.connection.Open();
            SqlCommand command = new SqlCommand();
            command.Connection = dbcon.connection;
            command.CommandType = CommandType.StoredProcedure;
            command.CommandText = "sp_PurchaseOrderNoteApply";
            command.Parameters.Clear();
            command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
            command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));
            command.Parameters.Add(new SqlParameter("@TempDocNo", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strTempDocumentNo));
            command.Parameters.Add(new SqlParameter("@OrgDoc_No", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strOrgDocNo));
            command.Parameters.Add(new SqlParameter("@Supp_Code", SqlDbType.NVarChar, 15, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strSuppCode));
            command.Parameters.Add(new SqlParameter("@Pay_Type", SqlDbType.NVarChar, 15, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strPay_Type));
            command.Parameters.Add(new SqlParameter("@Remarks", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strRemark));
            command.Parameters.Add(new SqlParameter("@ContactPerson", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strContactPerson));
            command.Parameters.Add(new SqlParameter("@ShiftHeader", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strShiftToHeader));
            command.Parameters.Add(new SqlParameter("@ShiftAddress1", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strShiftAddress1));
            command.Parameters.Add(new SqlParameter("@ShiftAddress2", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strShiftAddress2));
            command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));
            command.Parameters.Add(new SqlParameter("@Post_Date", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strPostDate));
            command.Parameters.Add(new SqlParameter("@Expected_Date", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strExpectedDate));
            command.Parameters.Add(new SqlParameter("@Credit_Period", SqlDbType.Int,0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, intCreditPeriod));
            command.Parameters.Add(new SqlParameter("@User_Name", SqlDbType.NVarChar, 100, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.UserName.Trim().ToUpper()));
            command.Parameters.Add(new SqlParameter("@GrossAmount", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decGrossAmount));
            command.Parameters.Add(new SqlParameter("@Tax", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decTax));
            command.Parameters.Add(new SqlParameter("@Amount", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decTotalAmount));

            command.ExecuteNonQuery();
            command.UpdatedRowSource = UpdateRowSource.OutputParameters;
            ErrorCode = (int)(command.Parameters["@Err_x"].Value);
            dbcon.connection.Close();
        }

        public void GetDataSetForReport()
        {
            dsForReport = dbcon.getDataset("SELECT Transaction_Header.Doc_No, Transaction_Header.Post_Date, Transaction_Header.Supplier_Id, Supplier.Supp_Name, Transaction_Header.Pay_Type, Transaction_Header.Remarks, Transaction_Header.Expected_Date, Transaction_Header.AddRemarks, Transaction_Header.Reference, Transaction_Header.PayRemark1, Transaction_Header.PayRemark2, Transaction_Header.Tax, Transaction_Details.Prod_Code, Transaction_Details.Prod_Name, Transaction_Details.Qty, Transaction_Details.Purchase_Price, Transaction_Details.Selling_Price, Transaction_Details.Amount, Transaction_Details.Ln, Supplier.Address1, Supplier.Address2, Supplier.Address3, Supplier.Address4, Supplier.Tel, Supplier.Fax, Transaction_Header.Amount NetAmount, Transaction_Header.Pay1, 'Original' Status from Transaction_Header INNER JOIN Transaction_Details ON Transaction_Header.Doc_No = Transaction_Details.Doc_No AND Transaction_Header.Loca = Transaction_Details.Loca AND Transaction_Header.Iid = Transaction_Details.Iid INNER JOIN Supplier ON Transaction_Header.Supplier_Id = Supplier.Supp_Code WHERE Transaction_Header.IId = 'PON' AND Transaction_Header.Doc_No = '" + strOrgDocNo + "' AND Transaction_Header.Loca = " + LoginManager.LocaCode, "dsPurchaseOrderDetails");
        }

        public void GetDataSetForPreviewReport()
        {
            DateTime PostDate = DateTime.Now;
            strPostDate = string.Format("{0:dd/MM/yyyy}", PostDate);
            dsForReport = dbcon.getDataset("SELECT TransactionTemp_Details.Doc_No, '" + strPostDate + "' Post_Date, '" + strSuppCode + "' Supplier_Id, '" + strSuppName + "' Supp_Name, '" + strPay_Type + "' Pay_Type, '" + strRemark + "' Remarks, '" + strExpectedDate + "' Expected_Date, '" + strContactPerson + "' AddRemarks, '" + strShiftToHeader + "' Reference, '" + strShiftAddress1 + "' PayRemark1, '" + strShiftAddress2 + "' PayRemark2, " + decTax + " Tax, TransactionTemp_Details.Prod_Code, TransactionTemp_Details.Prod_Name, TransactionTemp_Details.Qty, TransactionTemp_Details.Purchase_Price, TransactionTemp_Details.Selling_Price, TransactionTemp_Details.Amount, TransactionTemp_Details.Ln, supplier.Address1, Supplier.Address2, Supplier.Address3, Supplier.Address4, Supplier.Tel, Supplier.Fax, " + (decGrossAmount + decTax)  + " NetAmount, " + intCreditPeriod + " Pay1, 'Temporary' Status from TransactionTemp_Details INNER JOIN Supplier ON Supplier.Supp_Code = '" + strSuppCode + "' WHERE TransactionTemp_Details.IId = 'PON' AND TransactionTemp_Details.Doc_No = '" + strTempDocumentNo + "' AND TransactionTemp_Details.Loca = " + LoginManager.LocaCode, "dsPurchaseOrderDetails");
        }

        public void DeleteProductDetaile()
        {
            intErrCode = 0;
            dbcon.connection.Open();
            SqlCommand command = new SqlCommand();
            command.Connection = dbcon.connection;
            command.CommandType = CommandType.StoredProcedure;
            command.CommandText = "sp_PonTemp_Delete";
            command.Parameters.Clear();
            command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
            command.Parameters.Add(new SqlParameter("@Doc_No", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strTempDocumentNo));
            command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.VarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));
            command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));
            command.Parameters.Add(new SqlParameter("@Prod_Code", SqlDbType.NVarChar, 25, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strProductCode));

            command.ExecuteNonQuery();
            command.UpdatedRowSource = UpdateRowSource.OutputParameters;
            ErrorCode = (int)(command.Parameters["@Err_x"].Value);
            dbcon.connection.Close();
        }

        public void PurchaseOrderNoteSave()
        {
            DateTime PostDate = DateTime.Now;

            intErrCode = 0;
            //Get Orginal Document No
            //GetSaveDocumentNo();
            //Document Save with the Temorary Document No
            strOrgDocNo = strTempDocumentNo;

            strPostDate = string.Format("{0:dd/MM/yyyy}", PostDate);

            dbcon.connection.Open();
            SqlCommand command = new SqlCommand();
            command.Connection = dbcon.connection;
            command.CommandType = CommandType.StoredProcedure;
            command.CommandText = "sp_PurchaseOrderNoteSave";
            command.Parameters.Clear();
            command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
            command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));
            command.Parameters.Add(new SqlParameter("@TempDocNo", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strTempDocumentNo));
            command.Parameters.Add(new SqlParameter("@OrgDoc_No", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strOrgDocNo));
            command.Parameters.Add(new SqlParameter("@Supp_Code", SqlDbType.NVarChar, 15, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strSuppCode));
            command.Parameters.Add(new SqlParameter("@Pay_Type", SqlDbType.NVarChar, 15, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strPay_Type));
            command.Parameters.Add(new SqlParameter("@Remarks", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strRemark));
            command.Parameters.Add(new SqlParameter("@ContactPerson", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strContactPerson));
            command.Parameters.Add(new SqlParameter("@ShiftHeader", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strShiftToHeader));
            command.Parameters.Add(new SqlParameter("@ShiftAddress1", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strShiftAddress1));
            command.Parameters.Add(new SqlParameter("@ShiftAddress2", SqlDbType.NVarChar, 50, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strShiftAddress2));
            command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));
            command.Parameters.Add(new SqlParameter("@Post_Date", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strPostDate));
            command.Parameters.Add(new SqlParameter("@Expected_Date", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strExpectedDate));
            command.Parameters.Add(new SqlParameter("@User_Name", SqlDbType.NVarChar, 100, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.UserName.Trim().ToUpper()));
            command.Parameters.Add(new SqlParameter("@GrossAmount", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decGrossAmount));
            command.Parameters.Add(new SqlParameter("@Tax", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decTax));
            command.Parameters.Add(new SqlParameter("@Amount", SqlDbType.Money, 0, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, decTotalAmount));

            command.ExecuteNonQuery();
            command.UpdatedRowSource = UpdateRowSource.OutputParameters;
            ErrorCode = (int)(command.Parameters["@Err_x"].Value);
            dbcon.connection.Close();
        }

        public void ReadSavedDocument()
        {
            DataReader = dbcon.GetReader(strSqlStatement + LoginManager.LocaCode);
            blRecordFound = false;
            if (DataReader.Read())
            {
                strTempDocumentNo = strRecallSaveDocNo;
                strSuppCode = DataReader["Supplier_Id"].ToString();
                strSuppName = DataReader["Supp_Name"].ToString();
                strPay_Type = DataReader["Pay_Type"].ToString();
                strRemark = DataReader["Remarks"].ToString();
                decTax = (decimal)DataReader["Tax"];
                strContactPerson = DataReader["AddRemarks"].ToString();
                strShiftToHeader = DataReader["Reference"].ToString();
                strShiftAddress1 = DataReader["PayRemark1"].ToString();
                strShiftAddress2 = DataReader["PayRemark2"].ToString();
                strExpectedDate = DataReader["Expected_Date"].ToString();
                blRecordFound = true;
            }
            else
            {
                strProductCode = string.Empty;
                strProductName = string.Empty;
                fltCurrentQty = 0;
                decPurchasePrice = 0;
                decSellingPrice = 0;
                strContactPerson = string.Empty;
                strShiftToHeader = string.Empty;
                strShiftAddress1 = string.Empty;
                strShiftAddress2 = string.Empty;
                blRecordFound = false;
            }
            dbcon.CloseReader();
            DataReader.Dispose();

            //Reload Saved Items to the Tempory
            if (blRecordFound == true)
            {
                dbcon.connection.Open();
                SqlCommand command = new SqlCommand();
                command.Connection = dbcon.connection;
                command.CommandType = CommandType.StoredProcedure;
                command.CommandText = "sp_PurchaseOrderNoteRecall";
                command.Parameters.Clear();
                command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
                command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));
                command.Parameters.Add(new SqlParameter("@TempDocNo", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strRecallSaveDocNo));
                command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));

                command.ExecuteNonQuery();
                command.UpdatedRowSource = UpdateRowSource.OutputParameters;
                ErrorCode = (int)(command.Parameters["@Err_x"].Value);
                dbcon.connection.Close();
            }
            //***
        }

        public void SelectReOrderProductDetaile()
        {
            intErrCode = 0;
            dbcon.connection.Open();
            SqlCommand command = new SqlCommand();
            command.Connection = dbcon.connection;
            command.CommandType = CommandType.StoredProcedure;
            command.CommandText = "sp_PonReOrderProductDetaile";
            command.Parameters.Clear();
            command.Parameters.Add(new SqlParameter("@Err_x", SqlDbType.Int, 0, ParameterDirection.InputOutput, false, 0, 0, "", DataRowVersion.Default, intErrCode));
            command.Parameters.Add(new SqlParameter("@Doc_No", SqlDbType.NVarChar, 10, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strTempDocumentNo));
            command.Parameters.Add(new SqlParameter("@Loca", SqlDbType.VarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, LoginManager.LocaCode));
            command.Parameters.Add(new SqlParameter("@Iid", SqlDbType.NVarChar, 5, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, "PON"));
            command.Parameters.Add(new SqlParameter("@Supp_Code", SqlDbType.NVarChar, 15, ParameterDirection.Input, false, 0, 0, "", DataRowVersion.Default, strSuppCode ));

            command.ExecuteNonQuery();
            command.UpdatedRowSource = UpdateRowSource.OutputParameters;
            ErrorCode = (int)(command.Parameters["@Err_x"].Value);
            dbcon.connection.Close();
        }
    }
}
