using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using clsLibrary;
namespace Inventory
{
    public partial class frmChangePassword : Form
    {
        public frmChangePassword()
        {
            InitializeComponent();
        }

        clsUserProfile objUserProfile = new clsUserProfile();

        private string strQuery;

        private static frmChangePassword ChangePassword;

        public static frmChangePassword GetChangePassword
        {
            get
            {
                return ChangePassword;
            }
            set
            {
                ChangePassword = value;
            }
        }

        private void btnClose_Click(object sender, EventArgs e)
        {
            this.Close();
            this.Dispose();
            ChangePassword = null;
        }

        private void frmChangePassword_FormClosed(object sender, FormClosedEventArgs e)
        {
            ChangePassword = null;
        }

        private void frmChangePassword_FormClosing(object sender, FormClosingEventArgs e)
        {
            // Hide the form...
            this.Hide();

            // Cancel the close...
            e.Cancel = true;
        }

        private void frmChangePassword_Load(object sender, EventArgs e)
        {
            lblUserName.Text = LoginManager.UserName.Trim().ToUpper();
            btnChange.Enabled = false;
            txtPassword.Enabled = false;
            txtConfirmPassword.Enabled = false;
        }

        private void txtOldPassword_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                objUserProfile.SqlStatement = "SELECT Emp_Name, Loca from employee WHERE Emp_Name = '" + lblUserName.Text.Trim() + "' and Pass_Word = '"+ txtOldPassword.Text.Trim() +"' and Loca = '" + LoginManager.LocaCode + "'";
                objUserProfile.ReadUserName();
                if (objUserProfile.RecordFound == true)
                {
                    btnChange.Enabled = true ;
                    txtPassword.Enabled = true;
                    txtConfirmPassword.Enabled = true;
                    txtPassword.Focus();
                }
                else
                {
                    MessageBox.Show("The Entered Password Not Correct. Please Enter Correct Password.", "Change Password", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    return;
                }
            }
        }

        private void txtPassword_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter && txtPassword.Text.Trim() != string.Empty )
            {
                txtConfirmPassword.Focus();
            }
            
        }

        private void txtConfirmPassword_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter && txtPassword.Text.Trim() != string.Empty && txtPassword.Text.Trim() == txtConfirmPassword.Text.Trim())
            {
                btnChange.Focus();
            }
        }

        private void btnChange_Click(object sender, EventArgs e)
        {
            if (txtPassword.Text.Trim().ToUpper() != txtConfirmPassword.Text.Trim().ToUpper())
            {
                MessageBox.Show("The Password was Not Correctly Confirmed. Please Check Password and Confirmed Password are Match exactly.", "User Profile", MessageBoxButtons.OK, MessageBoxIcon.Information);
                txtPassword.Focus();
                return;
            }

            objUserProfile.UserName = lblUserName.Text.Trim();
            objUserProfile.Password = txtPassword.Text.Trim();
            objUserProfile.ChangePassword();
            MessageBox.Show("Password Cahnged Successfully.", "Password Change", MessageBoxButtons.OK, MessageBoxIcon.Information);
            txtOldPassword.Text = string.Empty;
            txtPassword.Text = string.Empty;
            txtConfirmPassword.Text = string.Empty;
            btnChange.Enabled = false;
            txtPassword.Enabled = false;
            txtConfirmPassword.Enabled = false;
            txtOldPassword.Focus();

        }
    }
}