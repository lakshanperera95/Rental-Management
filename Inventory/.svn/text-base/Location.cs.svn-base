using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using clsLibrary;

namespace Inventory
{
    public partial class frmLocation : Form
    {
        private int Err = 0;
        private string query;
        frmSearch search = new frmSearch();

        public frmLocation()
        {
            InitializeComponent();
        }

        private static frmLocation location;
        //property for location
        public static frmLocation GetLocation {
            get
            {
                return location;
            }
            set
            {
                location = value;
            }
        
        }

        private void CmdHlpDesc_Click(object sender, EventArgs e)
        {

        }

        private void btnExit_Click(object sender, EventArgs e)
        {
            //new clsMenuControler().Location.Close();
            this.Close();
            this.Dispose();
            location = null;
        }

        private void btnSave_Click(object sender, EventArgs e)
        {
            Err = 0;
            errLocaName.Clear();
            errLocaCode.Clear();

            if (TxtLocaCode.Text == string.Empty)
            {
                errLocaCode.SetError(TxtLocaCode, "Location Code is mandatory feild");
                Err++;

            }

            if (TxtLocaName.Text == string.Empty)
            {
                errLocaName.SetError(TxtLocaName, "Location Name is mandatory feild");
                Err++;
            }
            if (numvalidate(TxtLocaCode.Text) == 1)
            {
                MessageBox.Show("A numeric field, Location Code contains alpha characters. Please check the data entered. ", "Non numeric character found", MessageBoxButtons.OK, MessageBoxIcon.Stop);
                Err++;
            }

            this.validator(GrbHeader);
            if (Err == 0)
            {
                clsLocation.getlocation().ErrorCode = 0;
                clsLocation.getlocation().LocationCode = TxtLocaCode.Text.Trim().ToUpper();
                clsLocation.getlocation().LocationName = TxtLocaName.Text.Trim().ToUpper();
                clsLocation.getlocation().Address1 = TxtAddress1.Text.Trim().ToUpper();
                clsLocation.getlocation().Address2 = TxtAddress2.Text.Trim().ToUpper();
                clsLocation.getlocation().Address3 = TxtAddress3.Text.Trim().ToUpper();
                clsLocation.getlocation().Telephone = TxtTelephone.Text.Trim().ToUpper();
                clsLocation.getlocation().Fax = TxtFax.Text.Trim().ToUpper();
                clsLocation.getlocation().Email = TxtEmail.Text.Trim();
                clsLocation.getlocation().Tax = TxtTaxReg.Text.Trim().ToUpper().ToUpper();

                //clear all the properties used in search form
                search.Code = string.Empty;
                search.Descript = string.Empty;
                search.prop_Focus = null ;
                search.prop_Name = string.Empty;

                clsLocation.getlocation().UpdateData(GrbHeader, TxtLocaCode);
                
            }
        }

        private void btnClear_Click(object sender, EventArgs e)
        {
            clsClear.getclear().clearfeilds(GrbHeader, TxtLocaCode);
        }

 #region Delete command button
        private void btnDelete_Click(object sender, EventArgs e)
        {
            // Display a message box asking users if they
            // want to delete the record
            if (TxtLocaCode.Text != string.Empty)
            {
                if (MessageBox.Show("Do you really want to delete the record ?  " + TxtLocaCode .Text  + "", "Location Details",
                      MessageBoxButtons.YesNo, MessageBoxIcon.Question)
                      == DialogResult.Yes)
                {
                    clsLocation.getlocation().DeleteData(TxtLocaCode.Text,GrbHeader,TxtLocaCode);
                }

            }
        }
#endregion
 #region Validate whether textfeilds contains ' character
        public void validator(Control text)
        {

            for (int i = 0; i < text.Controls.Count; i++)
            {
                if ((text.Controls[i].GetType() == typeof(TextBox)) && (text.Controls[i].Text.Contains("'")))
                {
                    MessageBox.Show("Invalid characters in Textfeilds Please check the characters entered.", "Invalid character (') found", MessageBoxButtons.OK, MessageBoxIcon.Stop);
                    text.Controls[i].Text = string.Empty;
                    text.Controls[i].Focus();

                    Err++;

                }
            }
        }
#endregion
        public int numvalidate(string str)
        {
            try
            {
                if (str == string.Empty)
                {
                    return 0;
                }
                else { 
                int result = int.Parse(str);
                return 0;
                }
            }
            catch
            {
                return 1;
            }
        }

        private void CmdHlpLocation_Click(object sender, EventArgs e)
        {
            if (search.IsDisposed){
                search = new frmSearch();
            }
            query = "SELECT  Loca As Code ,Loca_Descrip AS Description FROM [dbo].[Location]ORDER BY Loca";
            search.dgSearch.DataSource = clsRetriveGenaral.combofill1(query).Tables["Table"];
            search.prop_Focus = TxtLocaCode;
            search.Cont_Descript = TxtLocaName;
            search.Show();
        }

        private void frmLocation_Leave(object sender, EventArgs e)
        {
            clsLocation.getlocation().LocationCode = string.Empty;
            clsLocation.getlocation().LocationName = string.Empty;
            clsLocation.getlocation().Address1 = string.Empty;
            clsLocation.getlocation().Address2 = string.Empty;
            clsLocation.getlocation().Address3 = string.Empty;
            clsLocation.getlocation().Telephone = string.Empty;
            clsLocation.getlocation().Fax = string.Empty;
            clsLocation.getlocation().Email = string.Empty;
            clsLocation.getlocation().Tax = string.Empty;
            clsClear.getclear().clearfeilds(GrbHeader, TxtLocaCode);

        }

        private void TxtLocaCode_Enter(object sender, EventArgs e)
        {
            if (search.Code != null && search.Code != "")
            {
                TxtLocaCode.Text = search.Code;
                TxtLocaName.Text = search.Descript;
            }
            search.Code = string.Empty;
            search.Descript = string.Empty;
        }

        public void settext()
        { 
            query = "SELECT  Address1, Address2, Address3, Tel, Fax, Email, TaxReg FROM Location WHERE Loca = '" + TxtLocaCode.Text + "'";
            clsLocation.getlocation().GetDataset1 = clsLocation.getlocation().RetriveData(query);
            if (clsLocation.getlocation().GetDataset1.Tables ["Table"].Rows.Count > 0 ) {

                TxtAddress1.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][0].ToString();
                TxtAddress2.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][1].ToString();
                TxtAddress3.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][2].ToString();
                TxtTelephone.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][3].ToString();
                TxtFax.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][4].ToString();
                TxtEmail.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][5].ToString();
                TxtTaxReg.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][6].ToString();

                for (int i = 0; i < clsLocation.getlocation().GetDataset1.Tables.Count;i++ )
                {
                    clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][i] = "";
                }
            }
        }

        private void TxtLocaCode_TextChanged(object sender, EventArgs e)
        {
            //if (TxtLocaCode.Text != string.Empty ){
            //    this.settext();
            //}
        }

        private void frmLocation_FormClosed(object sender, FormClosedEventArgs e)
        {
            location = null;
        }

        private void TxtLocaCode_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                query = "SELECT  Address1, Address2, Address3, Tel, Fax, Email, TaxReg, Loca_Descrip FROM Location WHERE Loca = '" + TxtLocaCode.Text + "'";
                clsLocation.getlocation().GetDataset1 = clsLocation.getlocation().RetriveData(query);
                if (clsLocation.getlocation().GetDataset1.Tables["Table"].Rows.Count > 0)
                {
                    TxtAddress1.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][0].ToString();
                    TxtAddress2.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][1].ToString();
                    TxtAddress3.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][2].ToString();
                    TxtTelephone.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][3].ToString();
                    TxtFax.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][4].ToString();
                    TxtEmail.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][5].ToString();
                    TxtTaxReg.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][6].ToString();
                    TxtLocaName.Text = clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][7].ToString();
                    for (int i = 0; i < clsLocation.getlocation().GetDataset1.Tables.Count; i++)
                    {
                        clsLocation.getlocation().GetDataset1.Tables["Table"].Rows[0][i] = "";
                    }
                    TxtAddress1.Focus();
                }
                else
                {
                    TxtAddress1.Text = string.Empty;
                    TxtAddress2.Text = string.Empty;
                    TxtAddress3.Text = string.Empty;
                    TxtTelephone.Text = string.Empty;
                    TxtFax.Text = string.Empty;
                    TxtEmail.Text = string.Empty;
                    TxtTaxReg.Text = string.Empty;
                    TxtLocaName.Text = string.Empty;
                }
            }
        }

        private void TxtAddress2_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                TxtAddress3.Focus();
            }
        }

        private void TxtAddress3_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                TxtTelephone.Focus();
            }
        }

        private void TxtAddress1_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                TxtAddress2.Focus();
            }
        }

        private void TxtTelephone_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                TxtFax.Focus();
            }
        }

        private void TxtEmail_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                TxtTaxReg.Focus();
            }
        }

        private void TxtFax_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                TxtEmail.Focus();
            }
        }

        private void TxtTaxReg_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                btnSave.Select() ;
            }
        }

    }
}